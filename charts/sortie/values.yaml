# Default values for sortie

# Namespace configuration
namespace: sortie

# Database configuration
database:
  type: sqlite             # "sqlite" or "postgres"
  sqlite:
    path: "/data/sortie.db"
  postgres:
    host: ""
    port: 5432
    database: "sortie"
    user: "sortie"
    password: ""
    sslMode: "disable"
    dsn: ""                # Full DSN (takes precedence over individual params)
    existingSecret: ""     # Name of existing K8s Secret for SORTIE_DB_PASSWORD

# Seed data file path (optional, loads initial apps/categories on first run)
seed: ""

# Image configuration
image:
  repository: ghcr.io/rjsadow/sortie
  tag: latest
  pullPolicy: Always

# VNC sidecar image for container sessions
vncSidecar:
  image: ghcr.io/rjsadow/sortie-vnc-sidecar:latest

# Browser sidecar image for web_proxy sessions
browserSidecar:
  image: ghcr.io/rjsadow/sortie-browser-sidecar:latest

# Guacd sidecar image for Windows RDP sessions
guacdSidecar:
  image: guacamole/guacd:1.6.0

# Branding configuration
branding:
  configPath: ""           # Path to branding config JSON
  logoURL: ""              # Custom logo URL
  primaryColor: "#1F2A3C"
  secondaryColor: "#2B3445"
  tenantName: "Sortie"

# Replica count - supports >1 for horizontal scalability.
# When replicaCount > 1, persistence.enabled must be true with a ReadWriteMany
# storage class so all replicas share the same SQLite database.
# The application is stateless: sessions are stored in the database and
# any replica can serve any request.
replicaCount: 1

# JWT Authentication configuration
auth:
  enabled: true
  # JWT signing secret (minimum 32 characters)
  # Generate with: openssl rand -base64 32
  jwtSecret: ""
  # Access token expiry in minutes
  accessExpiry: "15"
  # Refresh token expiry in hours
  refreshExpiry: "24"
  # Initial admin credentials
  adminUsername: "admin"
  adminPassword: "admin123"
  # Allow user self-registration (can be changed by admin in UI)
  allowRegistration: false
  # Use existing secret instead of creating one
  existingSecret: ""

# OIDC/SSO authentication configuration
oidc:
  enabled: false
  issuer: ""
  clientId: ""
  clientSecret: ""
  redirectUrl: ""
  scopes: ""

# Session configuration
session:
  timeout: "120"           # Session timeout in minutes
  cleanupInterval: "5"     # Cleanup interval in minutes
  podReadyTimeout: "300"   # Pod ready timeout in seconds

# Gateway rate limiting
gateway:
  rateLimit: 10            # Requests per second per IP (0 = disabled)
  burst: 20                # Maximum burst size for rate limiter

# Session quotas
sessionQuotas:
  maxSessionsPerUser: 5    # Maximum concurrent sessions per user (0 = unlimited)
  maxGlobalSessions: 100   # Maximum concurrent sessions globally (0 = unlimited)

# Default resource limits for session pods
sessionResources:
  cpuRequest: "500m"
  cpuLimit: "2"
  memRequest: "512Mi"
  memLimit: "2Gi"

# File transfer configuration
fileTransfer:
  maxUploadSize: 104857600  # Maximum upload file size in bytes (100MB)

# Resource limits for the sortie server
resources:
  requests:
    cpu: "2"
    memory: "2Gi"
  limits:
    cpu: "2"
    memory: "2Gi"

# Service configuration
service:
  type: ClusterIP
  port: 80

# Ingress configuration
ingress:
  enabled: false
  host: sortie.example.com
  annotations: {}

# Network policies
networkPolicy:
  enabled: true

# Resource quota
resourceQuota:
  enabled: true
  pods: "50"
  requestsCpu: "20"
  requestsMemory: "40Gi"
  limitsCpu: "40"
  limitsMemory: "80Gi"

# Limit range
limitRange:
  enabled: true

# Session event recording configuration (lifecycle events, not video)
eventRecording:
  enabled: false
  endpoint: ""             # Optional endpoint for recording events
  bufferSize: 0            # Buffer size for async event processing

# Video recording configuration
recording:
  enabled: true
  storageBackend: "local"    # "local" or "s3"
  storagePath: "/data/recordings"
  maxSizeMB: 500
  retentionDays: 0           # 0 = keep forever
  s3:
    bucket: ""
    region: "us-east-1"
    endpoint: ""             # Custom S3 endpoint (MinIO)
    prefix: "recordings/"
    accessKeyID: ""          # Explicit AWS access key ID (optional)
    secretAccessKey: ""      # Explicit AWS secret access key (optional)
    existingSecret:
      accessKeyID:
        name: ""             # K8s Secret name containing the access key ID
        key: ""              # Key within that Secret
      secretAccessKey:
        name: ""             # K8s Secret name containing the secret access key
        key: ""              # Key within that Secret

# Billing/metering configuration
billing:
  enabled: false
  exporter: "log"          # Exporter type: "log" or "webhook"
  webhookUrl: ""           # Webhook URL (when exporter=webhook)
  exportInterval: "5"      # Export interval in minutes

# Session queueing configuration
queue:
  maxSize: 0               # Max queued requests when at capacity (0 = no queueing)
  timeout: "30"            # Per-request queue wait timeout in seconds

# Persistent storage for SQLite database (ignored when database.type is "postgres").
# Required for multi-replica deployments with SQLite.
# Use ReadWriteMany access mode with a shared filesystem (e.g., NFS, CephFS, EFS)
# when running more than one replica so all pods share the same database.
persistence:
  enabled: false
  # storageClass: ""  # Use default storage class if empty
  size: 1Gi
  accessModes:
    - ReadWriteOnce  # Change to ReadWriteMany for replicaCount > 1
