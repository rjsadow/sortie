# Sortie Configuration
# Copy this file to .env and customize as needed.
# All values shown are defaults (except where noted).

# =============================================================================
# Server Configuration
# =============================================================================

# Port to listen on (1-65535)
SORTIE_PORT=8080

# Path to SQLite database file
SORTIE_DB=sortie.db

# Path to apps.json for initial database seeding (optional)
# SORTIE_SEED=apps.json

# =============================================================================
# Branding Configuration
# =============================================================================

# Path to branding configuration JSON file
SORTIE_CONFIG=branding.json

# Logo URL for the application header (optional)
# SORTIE_LOGO_URL=https://example.com/logo.png

# Primary brand color (hex format: #RRGGBB)
SORTIE_PRIMARY_COLOR=#398D9B

# Secondary brand color (hex format: #RRGGBB)
SORTIE_SECONDARY_COLOR=#4AB7C3

# Tenant/organization name displayed in the UI
SORTIE_TENANT_NAME=Sortie

# =============================================================================
# Kubernetes Configuration
# =============================================================================

# Kubernetes namespace for session pods
# Falls back to in-cluster namespace if running in Kubernetes, then "default"
SORTIE_NAMESPACE=default

# Path to kubeconfig file (optional, uses in-cluster config if available)
# KUBECONFIG=~/.kube/config

# VNC sidecar container image for container sessions
SORTIE_VNC_SIDECAR_IMAGE=ghcr.io/rjsadow/sortie-vnc-sidecar:latest

# =============================================================================
# Session Configuration
# =============================================================================

# Session timeout in minutes (sessions older than this are cleaned up)
# Default: 120 (2 hours)
SORTIE_SESSION_TIMEOUT=120

# Interval between session cleanup runs in minutes
# Default: 5
SORTIE_SESSION_CLEANUP_INTERVAL=5

# Timeout for waiting for pod to become ready in seconds
# Default: 120 (2 minutes)
SORTIE_POD_READY_TIMEOUT=120

# =============================================================================
# Resource Limits & Quotas
# =============================================================================

# Maximum concurrent sessions per user (0 = unlimited, default: 5)
SORTIE_MAX_SESSIONS_PER_USER=5

# Maximum concurrent sessions globally (0 = unlimited, default: 100)
SORTIE_MAX_GLOBAL_SESSIONS=100

# Default CPU request for new sessions (Kubernetes resource format)
SORTIE_DEFAULT_CPU_REQUEST=500m

# Default CPU limit for new sessions
SORTIE_DEFAULT_CPU_LIMIT=2

# Default memory request for new sessions
SORTIE_DEFAULT_MEM_REQUEST=512Mi

# Default memory limit for new sessions
SORTIE_DEFAULT_MEM_LIMIT=2Gi

# =============================================================================
# Session Recording Configuration
# =============================================================================

# Enable session lifecycle event recording (default: false)
# When enabled, session state transitions (created, ready, failed, stopped,
# restarted, expired, terminated) are emitted as structured events.
# SORTIE_RECORDING_ENABLED=false

# Optional endpoint URL for sending recording events (for future use)
# SORTIE_RECORDING_ENDPOINT=

# Buffer size for async event processing (default: 0, for future use)
# SORTIE_RECORDING_BUFFER_SIZE=0

# =============================================================================
# JWT Authentication Configuration
# =============================================================================

# JWT signing secret (required for authentication, minimum 32 characters)
# Generate a secure secret: openssl rand -base64 32
# SORTIE_JWT_SECRET=your-32-character-secret-key-here

# Access token expiry in minutes (default: 15)
# SORTIE_JWT_ACCESS_EXPIRY=15

# Refresh token expiry in hours (default: 24)
# SORTIE_JWT_REFRESH_EXPIRY=24

# Initial admin username (default: admin)
# SORTIE_ADMIN_USERNAME=admin

# Initial admin password (required to create admin user on first run)
# SORTIE_ADMIN_PASSWORD=your-secure-password

# Allow user self-registration (default: false)
# Can be overridden by admin in the UI
# SORTIE_ALLOW_REGISTRATION=false

# =============================================================================
# OIDC/SSO Configuration (Optional)
# =============================================================================
# Configure these to enable "Sign in with SSO" alongside local login.
# Supports any OIDC-compliant provider: Auth0, Keycloak, Entra ID, Okta, etc.
# Requires SORTIE_JWT_SECRET to also be set (used for local JWT issuance).

# OIDC Issuer URL (provider's base URL, must support .well-known/openid-configuration)
# Examples:
#   Auth0:    https://your-tenant.auth0.com/
#   Keycloak: https://keycloak.example.com/realms/your-realm
#   Entra ID: https://login.microsoftonline.com/{tenant-id}/v2.0
#   Okta:     https://your-org.okta.com/oauth2/default
# SORTIE_OIDC_ISSUER=https://your-provider.example.com

# OIDC Client ID (from your identity provider's application registration)
# SORTIE_OIDC_CLIENT_ID=your-client-id

# OIDC Client Secret (from your identity provider's application registration)
# SORTIE_OIDC_CLIENT_SECRET=your-client-secret

# OIDC Redirect URL (must match the callback URL registered with your provider)
# Default format: https://your-sortie-domain/api/auth/oidc/callback
# SORTIE_OIDC_REDIRECT_URL=https://sortie.example.com/api/auth/oidc/callback

# OIDC Scopes (comma-separated, default: openid,profile,email)
# Add "groups" scope if your provider supports group claims for role mapping
# SORTIE_OIDC_SCOPES=openid,profile,email

# =============================================================================
# Network Egress Rules
# =============================================================================
# Per-application network egress policies are configured via the API when
# creating or updating applications (egress_policy field).
# See docs/NETWORK_EGRESS.md for details.
#
# Egress modes:
#   allowlist - Only DNS + listed destinations allowed (most secure)
#   denylist  - All traffic allowed except listed destinations
#   (empty)   - Inherit cluster-level default NetworkPolicy
#
# Requires a Kubernetes CNI plugin that supports NetworkPolicies (e.g., Calico, Cilium).

# =============================================================================
# Secrets Management Configuration
# =============================================================================
# Sortie supports external secret stores for sensitive configuration.
# Supported providers: env (default), vault, aws, kubernetes

# Secret provider to use (env, vault, aws, kubernetes)
# Default: env (reads from environment variables)
# SORTIE_SECRETS_PROVIDER=env

# -----------------------------------------------------------------------------
# HashiCorp Vault Configuration (when SORTIE_SECRETS_PROVIDER=vault)
# -----------------------------------------------------------------------------

# Vault server address
# SORTIE_VAULT_ADDR=http://vault:8200
# Or use the standard Vault environment variable:
# VAULT_ADDR=http://vault:8200

# Vault token for authentication (optional if using other auth methods)
# SORTIE_VAULT_TOKEN=s.xxxxx
# Or use the standard Vault environment variable:
# VAULT_TOKEN=s.xxxxx

# KV secrets engine mount path
# Default: secret
# SORTIE_VAULT_MOUNT_PATH=secret

# Vault namespace (Vault Enterprise only)
# SORTIE_VAULT_NAMESPACE=admin
# Or: VAULT_NAMESPACE=admin

# -----------------------------------------------------------------------------
# AWS Secrets Manager Configuration (when SORTIE_SECRETS_PROVIDER=aws)
# -----------------------------------------------------------------------------

# AWS region for Secrets Manager
# SORTIE_AWS_REGION=us-east-1
# Or use standard AWS environment variables:
# AWS_REGION=us-east-1
# AWS_DEFAULT_REGION=us-east-1

# Prefix for secret names in AWS Secrets Manager
# Secrets are looked up as: {prefix}/{key}
# SORTIE_AWS_SECRET_PREFIX=sortie

# AWS credentials (uses standard AWS credential chain if not set)
# AWS_ACCESS_KEY_ID=AKIA...
# AWS_SECRET_ACCESS_KEY=...
# AWS_SESSION_TOKEN=... (for temporary credentials)

# -----------------------------------------------------------------------------
# Kubernetes Secrets Configuration (when SORTIE_SECRETS_PROVIDER=kubernetes)
# -----------------------------------------------------------------------------

# Name of the Kubernetes Secret to read from (required for k8s provider)
# SORTIE_K8S_SECRET_NAME=sortie-secrets

# Namespace where the secret is located
# Default: current namespace (from service account) or "default"
# SORTIE_K8S_SECRET_NAMESPACE=default

# Path to kubeconfig (optional, uses in-cluster config by default)
# KUBECONFIG=~/.kube/config

# -----------------------------------------------------------------------------
# Billing/Metering Configuration
# -----------------------------------------------------------------------------

# Enable metering event collection for billing
# SORTIE_BILLING_ENABLED=false

# Exporter type: "log" (default, writes to stdout) or "webhook" (posts to URL)
# SORTIE_BILLING_EXPORTER=log

# Webhook URL for billing export (required when exporter=webhook)
# Use for Stripe, custom billing, or data pipelines
# SORTIE_BILLING_WEBHOOK_URL=https://api.stripe.com/v1/usage_records

# Export interval in minutes (default: 5)
# SORTIE_BILLING_EXPORT_INTERVAL=5
